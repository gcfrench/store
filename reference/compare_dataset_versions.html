<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compare two versions of a dataset — compare_dataset_versions • store</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compare two versions of a dataset — compare_dataset_versions" />
<meta property="og:description" content="This function compares two versions of a dataset returning the dataset with the added, removed
or changed rows identified, using the daff package.
The compared dataset can then be exported into an Excel spreadsheet to quickly
identify where values have been changed using conditional formatting, on text
containing #." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">store</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    information
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/create_update_package_information.html">Create and update a package</a>
    </li>
    <li>
      <a href="../articles/raster_package_tutorial_notes.html">Raster package tutorial notes</a>
    </li>
    <li>
      <a href="../articles/postgres_database_notes.html">PostgreSQL database notes</a>
    </li>
    <li>
      <a href="../articles/validation_checks.html">Run validation checks</a>
    </li>
    <li>
      <a href="../articles/gdal_commands.html">GDAL commands</a>
    </li>
    <li>
      <a href="../articles/docker_notes.html">Docker notes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">lookups and functions</a>
</li>
<li>
  <a href="../news/index.html">versions</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/gcfrench">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/gcfrench/store">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compare two versions of a dataset</h1>
    <small class="dont-index">Source: <a href='https://github.com/gcfrench/store/blob/master/R/quality_assurance.R'><code>R/quality_assurance.R</code></a></small>
    <div class="hidden name"><code>compare_dataset_versions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function compares two versions of a dataset returning the dataset with the added, removed
or changed rows identified, using the <a href='https://github.com/edwindj/daff'>daff package</a>.
The compared dataset can then be exported into an Excel spreadsheet to quickly
identify where values have been changed using conditional formatting, on text
containing #.</p>
    </div>

    <pre class="usage"><span class='fu'>compare_dataset_versions</span><span class='op'>(</span><span class='va'>old_version</span>, <span class='va'>new_version</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>old_version</th>
      <td><p>The earlier version of the dataset as a data frame.</p></td>
    </tr>
    <tr>
      <th>new_version</th>
      <td><p>The later version of the dataset as a data frame.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The data frame with an additional difference column indicating new, removed or
updated rows highlighted with #.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>An initial check should be performed prior to comparing versions to check that
the column names are identical and that there has not been any addition or removal
of columns between dataset versions, so that the dataset schema can be made the same
between versions if necessary. This check can be done using the compare function
in the <a href='https://www.tidyverse.org/blog/2020/10/waldo/'>waldo package</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressPackageStartupMessages</a></span><span class='op'>(</span><span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gcfrench.github.io/store'>store</a></span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://allisonhorst.github.io/palmerpenguins/'>palmerpenguins</a></span><span class='op'>)</span>
    <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>

<span class='co'># select top 5 heaviest penguins from each species on each island</span>
<span class='va'>heaviest_penguins</span> <span class='op'>&lt;-</span> <span class='va'>penguins</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>species</span>, <span class='va'>island</span>, <span class='va'>body_mass_g</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>species</span>, <span class='va'>island</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>body_mass_g</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>heaviest_penguins</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 25 x 3</span><span>
#&gt;    species island body_mass_g
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;fct&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;fct&gt;</span><span>        </span><span style='color: #949494;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> Adelie  Biscoe        </span><span style='text-decoration: underline;'>4</span><span>775
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> Adelie  Biscoe        </span><span style='text-decoration: underline;'>4</span><span>725
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> Adelie  Biscoe        </span><span style='text-decoration: underline;'>4</span><span>600
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> Adelie  Biscoe        </span><span style='text-decoration: underline;'>4</span><span>400
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> Adelie  Biscoe        </span><span style='text-decoration: underline;'>4</span><span>300
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> Adelie  Dream         </span><span style='text-decoration: underline;'>4</span><span>650
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> Adelie  Dream         </span><span style='text-decoration: underline;'>4</span><span>600
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> Adelie  Dream         </span><span style='text-decoration: underline;'>4</span><span>475
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> Adelie  Dream         </span><span style='text-decoration: underline;'>4</span><span>450
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> Adelie  Dream         </span><span style='text-decoration: underline;'>4</span><span>400
#&gt; </span><span style='color: #949494;'># ... with 15 more rows</span><span></div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressPackageStartupMessages</a></span><span class='op'>(</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>

<span class='co'>## each version will require an unique identifier</span>
<span class='va'>heaviest_penguins</span> <span class='op'>&lt;-</span> <span class='va'>heaviest_penguins</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>id</span><span class='op'>)</span>

<span class='co'>## old_version: exclude Chinstrap penguins</span>
<span class='va'>heaviest_penguins_old</span> <span class='op'>&lt;-</span> <span class='va'>heaviest_penguins</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>species</span> <span class='op'>!=</span> <span class='st'>"Chinstrap"</span><span class='op'>)</span>

<span class='co'>## new_version: exclude Gentoo penguins and convert body mass to kilograms</span>
<span class='va'>heaviest_penguins_new</span> <span class='op'>&lt;-</span> <span class='va'>heaviest_penguins</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>species</span> <span class='op'>!=</span> <span class='st'>"Gentoo"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>body_mass_g <span class='op'>=</span> <span class='va'>body_mass_g</span> <span class='op'>/</span> <span class='fl'>1000</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>body_mass_kg <span class='op'>=</span> <span class='va'>body_mass_g</span><span class='op'>)</span>

<span class='co'># check columns and column names are identical between versions</span>
<span class='fu'>waldo</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/waldo/man/compare.html'>compare</a></span><span class='op'>(</span><span class='va'>heaviest_penguins_old</span>, <span class='va'>heaviest_penguins_new</span><span class='op'>)</span>
</div><div class='output co'>#&gt; `names(old)`: </span><span style='color: #555555;'>"id"</span><span> </span><span style='color: #555555;'>"species"</span><span> </span><span style='color: #555555;'>"island"</span><span> </span><span style='color: #00BB00;'>"body_mass_g"</span><span> 
#&gt; `names(new)`: </span><span style='color: #555555;'>"id"</span><span> </span><span style='color: #555555;'>"species"</span><span> </span><span style='color: #555555;'>"island"</span><span> </span><span style='color: #00BB00;'>"body_mass_kg"</span><span>
#&gt; 
#&gt; `old$id[13:20]`: </span><span style='color: #555555;'>13</span><span> </span><span style='color: #555555;'>14</span><span> </span><span style='color: #555555;'>15</span><span> </span><span style='color: #00BB00;'>21</span><span> </span><span style='color: #00BB00;'>22</span><span> </span><span style='color: #00BB00;'>23</span><span> </span><span style='color: #00BB00;'>24</span><span> </span><span style='color: #00BB00;'>25</span><span>
#&gt; `new$id[13:20]`: </span><span style='color: #555555;'>13</span><span> </span><span style='color: #555555;'>14</span><span> </span><span style='color: #555555;'>15</span><span> </span><span style='color: #00BB00;'>16</span><span> </span><span style='color: #00BB00;'>17</span><span> </span><span style='color: #00BB00;'>18</span><span> </span><span style='color: #00BB00;'>19</span><span> </span><span style='color: #00BB00;'>20</span><span>
#&gt; 
#&gt; `old$species[13:20]`: </span><span style='color: #555555;'>1</span><span> </span><span style='color: #555555;'>1</span><span> </span><span style='color: #555555;'>1</span><span> </span><span style='color: #00BB00;'>3</span><span> </span><span style='color: #00BB00;'>3</span><span> </span><span style='color: #00BB00;'>3</span><span> </span><span style='color: #00BB00;'>3</span><span> </span><span style='color: #00BB00;'>3</span><span>
#&gt; `new$species[13:20]`: </span><span style='color: #555555;'>1</span><span> </span><span style='color: #555555;'>1</span><span> </span><span style='color: #555555;'>1</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span>
#&gt; 
#&gt; `old$island[13:20]`: </span><span style='color: #555555;'>3</span><span> </span><span style='color: #555555;'>3</span><span> </span><span style='color: #555555;'>3</span><span> </span><span style='color: #00BB00;'>1</span><span> </span><span style='color: #00BB00;'>1</span><span> </span><span style='color: #00BB00;'>1</span><span> </span><span style='color: #00BB00;'>1</span><span> </span><span style='color: #00BB00;'>1</span><span>
#&gt; `new$island[13:20]`: </span><span style='color: #555555;'>3</span><span> </span><span style='color: #555555;'>3</span><span> </span><span style='color: #555555;'>3</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span> </span><span style='color: #00BB00;'>2</span><span>
#&gt; 
#&gt; `old$body_mass_g` is </span><span style='color: #0000BB;'>an integer vector</span><span> (4775, 4725, 4600, 4400, 4300, ...)
#&gt; `new$body_mass_g` is absent
#&gt; 
#&gt; `old$body_mass_kg` is absent
#&gt; `new$body_mass_kg` is </span><span style='color: #BBBB00;'>a double vector</span><span> (4.775, 4.725, 4.6, 4.4, 4.3, ...)</div><div class='input'>
<span class='co'># make columns same between versions</span>
<span class='va'>heaviest_penguins_old</span> <span class='op'>&lt;-</span> <span class='va'>heaviest_penguins_old</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>body_mass <span class='op'>=</span> <span class='va'>body_mass_g</span><span class='op'>)</span>

<span class='va'>heaviest_penguins_new</span> <span class='op'>&lt;-</span> <span class='va'>heaviest_penguins_new</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>body_mass <span class='op'>=</span> <span class='va'>body_mass_kg</span><span class='op'>)</span>

<span class='co'># compare versions of dataset</span>
<span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'>compare_dataset_versions</span><span class='op'>(</span><span class='va'>heaviest_penguins_old</span>, <span class='va'>heaviest_penguins_new</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 25 x 5</span><span>
#&gt;    differences   id    species island body_mass   
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> # row changed 1     Adelie  Biscoe 4775 # 4.775
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> # row changed 2     Adelie  Biscoe 4725 # 4.725
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> # row changed 3     Adelie  Biscoe 4600 # 4.6  
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> # row changed 4     Adelie  Biscoe 4400 # 4.4  
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> # row changed 5     Adelie  Biscoe 4300 # 4.3  
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> # row changed 6     Adelie  Dream  4650 # 4.65 
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> # row changed 7     Adelie  Dream  4600 # 4.6  
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> # row changed 8     Adelie  Dream  4475 # 4.475
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> # row changed 9     Adelie  Dream  4450 # 4.45 
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> # row changed 10    Adelie  Dream  4400 # 4.4  
#&gt; </span><span style='color: #949494;'># ... with 15 more rows</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Graham French.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


